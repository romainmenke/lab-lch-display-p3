<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Lab : interactive</title>

	<style>
		.container {
			display: inline-flex;
			flex-direction: row;
			flex-wrap: wrap;
			width: 500px;
		}

		.container div {
			height: 10px;
			width: 10px;
		}
	</style>
</head>
<body>
	<div style="width: 100%; padding: 50px;">
		<label for="lightness">Adjust L value</label>
		<input type="range" name="" id="lightness" min="0" max="100" step="1" onchange="self.renderColors()">

		<br>

		<label for="outline-out-of-gamut">Outline colors which are out of sRGB gamut</label>
		<input type="checkbox" name="" id="outline-out-of-gamut" onchange="self.renderColors()">
	</div>

	<div style="width: 1020px; display: flex; flex-wrap: wrap;">
		<div class="container" style="padding-right: 20px"><p>Lab converted to sRGB</p></div>
		<div class="container"><p>Lab rendered natively</p></div>
		<div id="container-rgb" class="container" style="padding-right: 20px"></div>
		<div id="container-lab" class="container"></div>
	</div>

	<script type="module">
		import { labToSRgb } from "./dist/convert-lab-to-srgb.js";

		const matrixRowSize = 50;

		const containerRGB = document.getElementById("container-rgb");
		const containerLAB = document.getElementById("container-lab");
		const matrix = [];

		self.renderColors = function renderColors() {
			const lightness = document.getElementById("lightness").value * 1;
			const showOutline = document.getElementById("outline-out-of-gamut").checked;
			for (let x = 0; x < matrixRowSize; x++) {
				if (!matrix[x]) {
					matrix[x] = [];
				}

				for (let y = 0; y < matrixRowSize; y++) {
					if (!matrix[x][y]) {
						matrix[x][y] = {
							rgb: containerRGB.appendChild(document.createElement("div")),
							lab: containerLAB.appendChild(document.createElement("div")),
						};
					}

					const { color: color, inGamut: inGamut } = labToSRgb([lightness, ((255 / matrixRowSize * x) - 127), ((255 / matrixRowSize * y) - 127)]);
					matrix[x][y].rgb.style.backgroundColor = `rgb(${Math.round(color[0] * 255)}, ${Math.round(color[1] * 255)}, ${Math.round(color[2] * 255)})`;
					matrix[x][y].rgb.setAttribute('title', `rgb(${Math.round(color[0] * 255)}, ${Math.round(color[1] * 255)}, ${Math.round(color[2] * 255)})\nlab(${lightness}% ${Math.round((255 / matrixRowSize * x) - 127)} ${Math.round((255 / matrixRowSize * y) - 127)})`);

					if (!inGamut && showOutline) {
						if (lightness < 50) {
							matrix[x][y].rgb.style.outline = "0.5px dotted white";
						} else {
							matrix[x][y].rgb.style.outline = "0.5px dotted black";
						}
					} else {
						matrix[x][y].rgb.style.outline = "0.5px dotted transparent";
					}

					matrix[x][y].lab.style.backgroundColor = `lab(${lightness}% ${((255 / matrixRowSize * x) - 127)} ${((255 / matrixRowSize * y) - 127)})`;
					matrix[x][y].lab.setAttribute('title', `rgb(${Math.round(color[0] * 255)}, ${Math.round(color[1] * 255)}, ${Math.round(color[2] * 255)})\nlab(${lightness}% ${Math.round((255 / matrixRowSize * x) - 127)} ${Math.round((255 / matrixRowSize * y) - 127)})`);
				}
			}
		}

		self.renderColors()
	</script>
</body>
</html>