<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Lab : interactive</title>

	<style>
		.container {
			display: inline-flex;
			flex-direction: row;
			flex-wrap: wrap;
			width: 500px;
		}

		#container-rgb div,
		#container-lab div {
			height: 10px;
			width: 10px;
		}
	</style>
</head>
<body>
	<div style="width: 100%; padding: 20px;">
		<label for="lightness">Adjust Lightness value</label>
		<input type="range" name="" id="lightness" min="0" max="100" step="1" onchange="self.renderColors()">
		<br>
	</div>

	<div style="width: 1020px; display: flex; flex-wrap: wrap;">
		<div class="container" style="padding-right: 20px">
			<div style="display: block; width: 100%">
				<p><b>Lab converted to sRGB.</b></p>
				
				<label for="outline-out-of-gamut-srgb">Outline out of gamut colors for sRGB</label>
				<input type="checkbox" name="" id="outline-out-of-gamut-srgb" onchange="self.renderColors()">
				<p><i>Colors out of gamut for sRGB (with outline) will have been adjusted through chroma reduction in OKLCH.</i></p>
			</div>
		</div>
		<div class="container">
			<div style="display: block; width: 100%">
				<p><b>Lab rendered natively. (only in Safari >= 15)</b></p>

				<label for="outline-out-of-gamut-display-p3">Outline out of gamut colors for Display-P3</label>
				<input type="checkbox" name="" id="outline-out-of-gamut-display-p3" onchange="self.renderColors()">
				<p><i>It seems as if Safari displays lab with what is available Display-P3.<br>Colors out of gamut (with outline) for Display-P3 might be clipped or modified in other ways.</i></p>
			</div>
		</div>
		<div id="container-rgb" class="container" style="padding-right: 20px"></div>
		<div id="container-lab" class="container"></div>
	</div>

	<script type="module">
		import { labToSRgb, labToP3 } from "./dist/convert-lab-to-srgb.js";

		const matrixRowSize = 50;

		const containerRGB = document.getElementById("container-rgb");
		const containerLAB = document.getElementById("container-lab");
		const matrix = [];

		self.renderColors = function renderColors() {
			const lightness = document.getElementById("lightness").value * 1;
			const showOutlineSRGB = document.getElementById("outline-out-of-gamut-srgb").checked;
			const showOutlineP3 = document.getElementById("outline-out-of-gamut-display-p3").checked;

			for (let x = 0; x < matrixRowSize; x++) {
				if (!matrix[x]) {
					matrix[x] = [];
				}

				for (let y = 0; y < matrixRowSize; y++) {
					if (!matrix[x][y]) {
						matrix[x][y] = {
							rgb: containerRGB.appendChild(document.createElement("div")),
							lab: containerLAB.appendChild(document.createElement("div")),
						};
					}

					const lab = [lightness, ((255 / (matrixRowSize - 1) * x) - 127), ((255 / (matrixRowSize - 1) * y) - 127)];
					const { color: color, inGamut: inGamut } = labToSRgb(lab);
					matrix[x][y].rgb.style.backgroundColor = `rgb(${Math.round(color[0] * 255)}, ${Math.round(color[1] * 255)}, ${Math.round(color[2] * 255)})`;
					matrix[x][y].rgb.setAttribute('title', `rgb(${Math.round(color[0] * 255)}, ${Math.round(color[1] * 255)}, ${Math.round(color[2] * 255)})\nlab(${lightness}% ${Math.round(lab[1])} ${Math.round(lab[2])})`);

					if (showOutlineSRGB && !inGamut) {
						if (lightness < 50) {
							matrix[x][y].rgb.style.outline = "0.5px dotted white";
						} else {
							matrix[x][y].rgb.style.outline = "0.5px dotted black";
						}
					} else {
						matrix[x][y].rgb.style.outline = "0.5px dotted transparent";
					}

					if (showOutlineP3 && !labToP3(lab).inGamut) {
						if (lightness < 50) {
							matrix[x][y].lab.style.outline = "0.5px dotted white";
						} else {
							matrix[x][y].lab.style.outline = "0.5px dotted black";
						}
					} else {
						matrix[x][y].lab.style.outline = "0.5px dotted transparent";
					}

					matrix[x][y].lab.style.backgroundColor = `lab(${lightness}% ${lab[1]} ${lab[2]})`;
					matrix[x][y].lab.setAttribute('title', `rgb(${Math.round(color[0] * 255)}, ${Math.round(color[1] * 255)}, ${Math.round(color[2] * 255)})\nlab(${lightness}% ${Math.round(lab[1])} ${Math.round(lab[2])})`);
				}
			}
		}

		self.renderColors()
	</script>
</body>
</html>